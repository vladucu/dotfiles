{{- /* Checks if running interactively, which is not the case for GitHub Codespaces */ -}}
{{- $interactive := stdinIsATTY -}}

{{/* Boolean feature tags */}}
{{/* If this machine should have Smile secrets from 1Password */}}
{{- $smile := false -}}
{{/* Multi-user installation. Will use a dedicated user for brew for better support for multi-user. */}}
{{/* Sources
https://www.codejam.info/2021/11/homebrew-multi-user.html
https://stackoverflow.com/a/70012833
 */}}
{{- $multi_user := true -}}
{{- "" -}}
{{/* Whether to use nix package manager or not */}}
{{- $use_nix := false -}}

{{/* Configs */}}
{{- $name := "Vlad Vanca" -}}
{{- $email := "vanca.vlad@gmail.com" -}}
{{- $computer_name := default "vladucu's macbook" (env "CM_computer_name") -}}
{{- $hostname := default "vladucu" (env "CM_hostname") -}}
{{- $gpg_recipient := "9F2DA28BEC99BC96" -}}
{{- "" -}}

{{- /* If running interactively */ -}}
{{- /*   - if config was previously set, reuse it */ -}}
{{- /*   - if config was not previously set, prompt */ -}}
{{- if $interactive -}}
{{-   if hasKey . "name" -}}
{{-     $name = .name -}}
{{-   else -}}
{{-     $name = promptString "Name" $name -}}
{{-   end -}}

{{-   if hasKey . "email" -}}
{{-     $email = .email -}}
{{-   else if $interactive -}}
{{-     $email = promptString "Email" $email -}}
{{-   end -}}

{{-   if hasKey . "computer_name" -}}
{{-     $computer_name = .computer_name -}}
{{-   else if $interactive -}}
{{-     $computer_name = promptString "Computer name" $computer_name -}}
{{-   end -}}

{{-   if hasKey . "hostname" -}}
{{-     $hostname = .hostname -}}
{{-   else if $interactive -}}
{{-     $hostname = promptString "Host name" $hostname -}}
{{-   end -}}

{{-   if hasKey . "gpg_recipient" -}}
{{-     $gpg_recipient = .gpg_recipient -}}
{{-   else if $interactive -}}
{{-     $gpg_recipient = promptString "GPG Recipient" $gpg_recipient -}}
{{-   end -}}

{{-   if hasKey . "smile" -}}
{{-     $smile = .smile -}}
{{-   else -}}
{{-     $smile = promptBool "Smile" -}}
{{-   end -}}

{{-   if hasKey . "multi_user" -}}
{{-     $multi_user = .multi_user -}}
{{-   else -}}
{{-     $multi_user = promptBool "Multi-user support" -}}
{{-   end -}}

{{-   if hasKey . "use_nix" -}}
{{-     $use_nix = .use_nix -}}
{{-   else -}}
{{-     $use_nix = promptBool "Use nix package manager" -}}
{{-   end -}}
{{- end -}}

{{- if $interactive -}}
{{-   writeToStdout "ðŸ’¡ Tip: you can re-enter your name and email with `chezmoi init --data=false`.\n" -}}
{{- end -}}


data:
  name: {{ $name | quote }}
  email: {{ $email | quote }}
  computer_name: {{ $computer_name | quote }}
  hostname: {{ $hostname | quote }}
  smile: {{ $smile }}
  multi_user: {{ $multi_user }}
  use_nix: {{ $use_nix }}
  vault: "xegovmwy3acc65sfscbzfje5fu"
  gpg_recipient: {{ $gpg_recipient | quote }}

encryption: "gpg"
gpg:
  recipient: {{ $gpg_recipient | quote }}
